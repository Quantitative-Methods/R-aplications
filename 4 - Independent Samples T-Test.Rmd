---
title: "Independent Samples T-Test"
output: 
  flexdashboard::flex_dashboard:
    theme: cerulean
    logo: R_logo.png
runtime: shiny
---

```{r}
library(flexdashboard)
library(shiny)
library(tidyverse)
library(DT)
library(psych)
library(car)
library(Rmisc)
library(gplots)
library(lsr)
library(RVAideMemoire)
library(ggthemes)

setwd("~/R-aplikacije/Data")

data <- read.table(file.choose(),                  
                   header = TRUE,                      
                   dec = ",",                          
                   sep = ";",                          
                   stringsAsFactors = TRUE,
                   row.names = 1)

Factor <- data %>% select_if(is.factor)
Dependent <- data %>% select_if(is.numeric)

my_data <- cbind(Factor, Dependent)
vn <- variable.names(Dependent)
nn <- variable.names(Factor)
mm <- ncol(data)
m <- ncol(Dependent)
k <- ncol(Factor)
n <- nrow(data)
x <- Dependent[,]
```

Data
=======================================================================
Column {data-width=1000}
-----------------------------------------------------------------------
### Data
```{r}
DT::datatable(data, style = 'bootstrap', 
              filter = 'top', 
              extensions = 'Buttons', 
              options = list(pageLength = n, dom = 'Brti', buttons = c('copy','csv', 'excel')))
```

Descirptive Parameters & Normality Test
=======================================================================
Column {data-width=1000}
-----------------------------------------------------------------------
### Descirptive Parameters & Normality Test
```{r}

shinyApp(

ui <- fluidPage(
        sidebarPanel(
          radioButtons("radio1", 
                       label = "Dependent Variables:",
                       choices = colnames(my_data[k+1:m])),
           radioButtons("radio2", 
                       label = "Independent Variables:",
                       choices = colnames(my_data[1:k])),
           sliderInput("bins",
                        "Broj razreda:",
                        min = 1,
                        max = 100,
                        value = 7)
          
        ),
        mainPanel(
          dataTableOutput ("des"),
          hr(),
          h5("Histogram"),
          plotOutput("histogram"),
          hr(),
          h5("Box and Whiskers plot"),
          plotOutput("box")
        )
),
server <- function(input, output, session) {

      selectedData1 <- reactive({
        my_data[, input$radio1]
  })
      selectedData2 <- reactive({   
        my_data[, input$radio2]
  })
      
       output$des <- renderDataTable({
        Variables <- selectedData1()
        Factor    <- selectedData2()
        des <- summarySE(my_data,measurevar= input$radio1, groupvars=c(input$radio2))
        CI1 <- des[3] - des$ci
        CI2 <- des[3] + des$ci
        des <- cbind(des, CI1, CI2)
        sw <- byf.shapiro(Variables~Factor, data=my_data)
        des <- cbind(des,sw$tab)
        des <- des[c(1, 2, 3, 4, 5, 7, 8, 9, 10)]
        colnames(des) <- c(input$radio2, "N", "MEAN", "SD", "SEM", "-CI95%", "+CI95%", "Shapiro-Wilk W", "P")
        des%>% DT::datatable (rownames = FALSE, 
                              style = 'bootstrap', 
                              extensions = 'Buttons', 
                              options = list(pageLength = 100, dom = 'Bt',buttons = c('copy'))) %>% 
        formatRound(c("MEAN", "SD", "SEM", "-CI95%", "+CI95%", "Shapiro-Wilk W", "P"), 3)
       })
       
      output$histogram <- renderPlot({
        Variables    <- selectedData1()
        Factor    <- selectedData2()
        ggplot(my_data, aes(x=Variables)) + 
        geom_histogram(bins=input$bins, color="#000000", fill="#4477AA") +
        labs(x= input$radio1, y = "Frequency") +
        facet_wrap(Factor)+
        theme_minimal()
  })
      
      output$box <- renderPlot({
        Variables  <- selectedData1()
        Groups     <- selectedData2()
        ggplot(my_data, aes(x=Groups, y=Variables, fill=Groups)) + 
        geom_boxplot(color="#000000", outlier.colour="#D1495B", outlier.size=3) +
        stat_summary(fun=mean, geom="point", shape=16, size=2, color="#000000") +
        labs(x = input$radio2, y = input$radio1, fill = input$radio2) +
        theme_minimal() + scale_fill_ptol()
  })
  
},
shinyApp(ui = ui, server = server)
)
```

Independent Samples T-Test
=======================================================================
Column {data-width=1000}
-----------------------------------------------------------------------
### Independent Samples T-Test
```{r}
shinyApp(

ui <- fluidPage(
        sidebarPanel(
          radioButtons("radio1", 
                       label = "Dependent Variables:",
                       choices = colnames(my_data[k+1:m])),
           radioButtons("radio2", 
                       label = "Independent Variables:",
                       choices = colnames(my_data[1:k])),
        ),
        mainPanel(
          htmlOutput("t"),
          hr(),
          h5 ("Mean Plot with 95% Confidence Interval"),
          plotOutput("err")
        )
        
),

server <- function(input, output, session) {

      selectedData1 <- reactive({
        my_data[, input$radio1]
  })
      selectedData2 <- reactive({   
        my_data[, input$radio2]
  })
 
      output$t <- renderText({
        Variables <- selectedData1()
        Factor     <- selectedData2()
        lt <- leveneTest (Variables ~ Factor, data = my_data, center = mean)
        Fl <- round(lt$`F value`[1], digits = 3)
        pl <- round(lt$`Pr(>F)`[1], digits = 3)
        tt <- t.test(Variables ~ Factor, data = my_data, var.equal = TRUE)
        tf <- t.test(Variables ~ Factor, data = my_data, var.equal = FALSE)
        ttt <- round(tt$statistic[1], digits = 3)
        dft <- round(tt$parameter[1], digits = 3)
        ptt <- round(tt$p.value[1], digits = 3)
        ttf <- round(tf$statistic[1], digits = 3)
        dff <- round(tf$parameter[1], digits = 3)
        ptf <- round(tf$p.value[1], digits = 3)
        d <- round(cohensD(Variables ~ Factor, method = "pooled"), digits = 3)
        if(pl>0.05){
          paste(
          "Levene's F = ", Fl, "</br>",
          "Levene's p = ", pl, "</br>",
          "Levene's test is not significant (p > .05)", "</br>",
          "Student's t = ", ttt ,"</br>",
          "df =", dft, "</br>",
          "p = ", ptt, "</br>", 
          "Cohen's d =", d)
          }
        else{
          paste(
          "Levene's F = ", Fl, "</br>",
          "Levene's p = ", pl, "</br>",
          "Levene's test is significant (p < .05), suggesting a violation of the assumption of equal variances", "</br>",
          "Welch's t = ", ttf , "</br>",
          "df =", dff, "</br>",
          "p = ", ptf, "</br>",
          "Cohen's d =", d)
          }
        
    })  
      
      output$err <- renderPlot({
        Variables <- selectedData1()
        Factor <-  selectedData2()
        plotmeans(Variables ~ Factor, 
                  data = my_data, 
                  col = "#D1495B",
                  barcol ="#4477AA", 
                  barwidth = 3,
                  connect = TRUE, 
                  n.label = FALSE, 
                  xlab = input$radio2, 
                  ylab = input$radio1,
                  )

    })
},
shinyApp(ui = ui, server = server)
)

```
